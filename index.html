
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Notify and take action on server updates via MQTT, with HomeAssistant compatibility">
      
      
      
        <link rel="canonical" href="https://updates2mqtt.rhizomatics.org.uk/">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Updates2MQTT</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#updates2mqtt" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Updates2MQTT" class="md-header__button md-logo" aria-label="Updates2MQTT" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Updates2MQTT
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/rhizomatics/updates2mqtt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    rhizomatics/updates2mqtt
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Updates2MQTT" class="md-nav__button md-logo" aria-label="Updates2MQTT" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Updates2MQTT
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rhizomatics/updates2mqtt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    rhizomatics/updates2mqtt
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span class="md-ellipsis">
      Install
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual" class="md-nav__link">
    <span class="md-ellipsis">
      Manual
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      Docker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Example configuration file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-secrets-out-of-config" class="md-nav__link">
    <span class="md-ellipsis">
      Moving Secrets Out of Config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-images-and-release-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing images and release notes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customizing images and release notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#icon-sources" class="md-nav__link">
    <span class="md-ellipsis">
      Icon Sources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Automated updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-docker-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Custom docker builds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#release-support" class="md-nav__link">
    <span class="md-ellipsis">
      Release Support
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#healthcheck" class="md-nav__link">
    <span class="md-ellipsis">
      Healthcheck
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#homeassistant-integration" class="md-nav__link">
    <span class="md-ellipsis">
      HomeAssistant integration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-projects" class="md-nav__link">
    <span class="md-ellipsis">
      Related Projects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-psmqtt-report-system-health-and-metrics-via-mqtt" class="md-nav__link">
    <span class="md-ellipsis">
      - psmqtt - Report system health and metrics via MQTT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    <span class="md-ellipsis">
      Development
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span class="md-ellipsis">
      Install
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual" class="md-nav__link">
    <span class="md-ellipsis">
      Manual
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      Docker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Example configuration file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-secrets-out-of-config" class="md-nav__link">
    <span class="md-ellipsis">
      Moving Secrets Out of Config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-images-and-release-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing images and release notes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customizing images and release notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#icon-sources" class="md-nav__link">
    <span class="md-ellipsis">
      Icon Sources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Automated updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-docker-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Custom docker builds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#release-support" class="md-nav__link">
    <span class="md-ellipsis">
      Release Support
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#healthcheck" class="md-nav__link">
    <span class="md-ellipsis">
      Healthcheck
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#homeassistant-integration" class="md-nav__link">
    <span class="md-ellipsis">
      HomeAssistant integration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-projects" class="md-nav__link">
    <span class="md-ellipsis">
      Related Projects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-psmqtt-report-system-health-and-metrics-via-mqtt" class="md-nav__link">
    <span class="md-ellipsis">
      - psmqtt - Report system health and metrics via MQTT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    <span class="md-ellipsis">
      Development
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<p><a href="https://github.com/rhizomatics"><img alt="Rhizomatics Open Source" src="https://avatars.githubusercontent.com/u/162821163?s=96&amp;v=4" /></a></p>
<h1 id="updates2mqtt">updates2mqtt<a class="headerlink" href="#updates2mqtt" title="Permanent link">&para;</a></h1>
<p><a href="https://github.com/rhizomatics/supernotify"><img alt="Ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json" /></a>
<a href="https://results.pre-commit.ci/latest/github/rhizomatics/updates2mqtt/main"><img alt="pre-commit.ci status" src="https://results.pre-commit.ci/badge/github/rhizomatics/updates2mqtt/main.svg" /></a>
<a href="https://github.com/rhizomatics/updates2mqtt/actions/workflows/python-package.yml"><img alt="Github Deploy" src="https://github.com/rhizomatics/updates2mqtt/actions/workflows/python-package.yml/badge.svg?branch=main" /></a>
<a href="https://github.com/rhizomatics/updates2mqtt/actions/workflows/github-code-scanning/codeql"><img alt="CodeQL" src="https://github.com/rhizomatics/updates2mqtt/actions/workflows/github-code-scanning/codeql/badge.svg" /></a>
<a href="https://github.com/rhizomatics/updates2mqtt/actions/workflows/dependabot/dependabot-updates"><img alt="Dependabot Updates" src="https://github.com/rhizomatics/updates2mqtt/actions/workflows/dependabot/dependabot-updates/badge.svg" /></a></p>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Use Home Assistant to notify you of updates to Docker images for your containers and optionally perform the <em>pull</em> (or optionally <em>build</em>) and <em>update</em>.</p>
<p><img alt="Example Home Assistant update dialog" src="images/ha_update_detail.png" title="Home Assistant Updates" /></p>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>updates2mqtt perioidically checks for new versions of components being available, and publishes new version info to MQTT.
HomeAssistant auto discovery is supported, so all updates can be seen in the same place as Home Assistant&rsquo;s
own components and add-ins.</p>
<p>Currently only Docker containers are supported, either via an image registry check, or a git repo for source. The design is modular, so other update sources can be added, at least for notification. The next anticipated is <strong>apt</strong> for Debian based systems.</p>
<p>Components can also be updated, either automatically or triggered via MQTT, for example by hitting the <em>Install</em>
button in the HomeAssistant update dialog. Icons and release notes can be specified for a better HA experience.</p>
<h2 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h2>
<p>updates2mqtt prefers to be run inside a Docker container.</p>
<h3 id="manual">Manual<a class="headerlink" href="#manual" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>uv sync
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>uv run updates2mqtt
</span></code></pre></div>
<h3 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h3>
<p>See <code>examples</code> directory for a working <code>docker-compose.yaml</code>.</p>
<p>If you want to update and restart containers, then the file system paths to the location of the
directory where the docker compose file lives must be available in the updates2mqtt container. </p>
<p>The example <code>docker-compose.yaml</code> mounts <code>/home/containers</code> for this purpose, so if your containers are in
<code>/home/containers/app1</code>, <code>/home/containers/app2</code> etc, then updates2mqtt will be able to find them. Map as
many root paths as needed.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>Create file <code>config.yaml</code> in <code>conf</code> directory. If the file is not present, a default file will be generated.</p>
<h3 id="example-configuration-file">Example configuration file<a class="headerlink" href="#example-configuration-file" title="Permanent link">&para;</a></h3>
<p>This is a maximal config file, the minimum is no config file at all, which will generate a default config file. The only mandatory values are the MQTT user name and password, everything else can be omitted.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">node</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker-host-1</span><span class="w"> </span><span class="c1"># Unique name for this instance, used to name MQTT entities. Defaults to O/S hostname</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="nt">git_repo_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/git</span><span class="w"> </span><span class="c1"># Path to git inside container, needed only if non-default and using local docker builds</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w"> </span><span class="c1"># publish a heartbeat every 5 minutes</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="nt">topic_template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">healthcheck/{node_name}/updates2mqtt</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="nt">mqtt</span><span class="p">:</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:MQTT_HOST}</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:MQTT_USER}</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:MQTT_PASS}$</span><span class="w"> </span><span class="c1"># Use an environment variable for secrets</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:MQTT_PORT}</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">  </span><span class="nt">topic_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updates2mqtt</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="nt">homeassistant</span><span class="p">:</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">  </span><span class="nt">discovery</span><span class="p">:</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">homeassistant</span><span class="w"> </span><span class="c1"># Matches the default MQTT discovery prefix in Home Assistant</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">  </span><span class="nt">state_topic_suffix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="nt">docker</span><span class="p">:</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">  </span><span class="nt">allow_pull</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># if true, will do a `docker pull` if an update is available</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">  </span><span class="nt">allow_restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># if true, will do a `docker-compose up` if an update is installed</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">  </span><span class="nt">allow_build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># if true, will do a `docker-compose build` if a git repo is configured</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">  </span><span class="nt">compose_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span><span class="w"> </span><span class="c1"># Controls whether to use `docker-compose` (v1) or `docker compose` (v2) command</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">  </span><span class="nt">default_entity_picture_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.docker.com/wp-content/uploads/2022/03/Moby-logo.png</span><span class="w"> </span><span class="c1"># Picture for update dialog</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">  </span><span class="nt">device_icon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mdi:docker</span><span class="w"> </span><span class="c1"># Material Design Icon to use when browsing entities in Home Assistant</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">  </span><span class="c1"># device_icon: mdi:train-car-container # Alternative icon if you don&#39;t like Docker branding</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">  </span><span class="nt">discover_metadata</span><span class="p">:</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">    </span><span class="nt">linuxserver.io</span><span class="p">:</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">      </span><span class="nt">cache_ttl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">604800</span><span class="w"> </span><span class="c1"># cache metadata for 1 week</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="nt">scan_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10800</span><span class="w"> </span><span class="c1"># sleep interval between scan runs, in seconds</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="nt">log</span><span class="p">:</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
</span></code></pre></div>
<h3 id="moving-secrets-out-of-config">Moving Secrets Out of Config<a class="headerlink" href="#moving-secrets-out-of-config" title="Permanent link">&para;</a></h3>
<p>Example use of environment variables, e.g. for secrets:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>mqtt:
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    password: ${oc.env:MQTT_PASS}
</span></code></pre></div>
<h3 id="customizing-images-and-release-notes">Customizing images and release notes<a class="headerlink" href="#customizing-images-and-release-notes" title="Permanent link">&para;</a></h3>
<p>Individual docker containers can have customized entity pictures or release notes, using env variables, for example in the <code>docker-compose.yaml</code> or in a separate <code>.env</code> file:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>    environment:
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>      - UPD2MQTT_PICTURE=https://frigate.video/images/logo.svg
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>      - UPD2MQTT_RELNOTES=https://github.com/blakeblackshear/frigate/releases
</span></code></pre></div>
<p>The images will show up in the <em>Update</em> section of <em>Settings</em> menu in HomeAssistant,
as will the release notes link. SVG icons should be used.</p>
<p>Some popular services have the icon and release note links pre-configured, in <code>common_packages.yaml</code>,
and packages from <code>linuxserver.io</code> can have metadata automatically discovered.</p>
<h4 id="icon-sources">Icon Sources<a class="headerlink" href="#icon-sources" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://github.com/homarr-labs/dashboard-icons">Homarr Dashboard Icons</a></li>
<li><a href="https://github.com/selfhst/icons">Self Hosted Icons</a></li>
<li><a href="https://github.com/simple-icons/simple-icons">Simple Icons</a></li>
<li><a href="https://tabler.io/icons">Tabler Icons</a></li>
<li><a href="https://github.com/PapirusDevelopmentTeam/papirus-icon-theme">Papirus Icons</a></li>
<li><a href="https://github.com/loganmarchione/homelab-svg-assets">Homelab SVG Assets</a></li>
</ul>
<h3 id="automated-updates">Automated updates<a class="headerlink" href="#automated-updates" title="Permanent link">&para;</a></h3>
<p>If Docker containers should be immediately updated, without any confirmation
or trigger, <em>e.g.</em> from the HomeAssistant update dialog, then set an environment variable <code>UPD2MQTT_UPDATE</code>
in the target container to <code>Auto</code> ( it defaults to <code>Passive</code>)</p>
<h3 id="custom-docker-builds">Custom docker builds<a class="headerlink" href="#custom-docker-builds" title="Permanent link">&para;</a></h3>
<p>If the image is locally built from a checked out git repo, package update can be driven
by the availability of git repo changes to pull rather than a new image on a Docker registry.</p>
<p>Declare the git path using the env var in <code>UPD2MQTT_GIT_REPO_PATH</code> in the docker container ( directly or via an <code>.env</code> file).
The git repo at this path will be used as the source of timestamps, and an update command will carry out a 
<code>git pull</code> and <code>docker-compose build</code> rather than pulling an image.</p>
<p>Note that the updates2mqtt docker container needs access to this path declared in its volumes, and that has to
be read/write if automated install required.</p>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">&para;</a></h3>
<p>The following environment variables can be used to configure updates2mqtt:</p>
<table>
<thead>
<tr>
<th>Env Var</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UPD2MQTT_UPDATE</code></td>
<td>Update mode, either <code>Passive</code> or <code>Auto</code>. If <code>Auto</code>, updates will be installed automatically.</td>
<td><code>Passive</code></td>
</tr>
<tr>
<td><code>UPD2MQTT_PICTURE</code></td>
<td>URL to an icon to use in Home Assistant.</td>
<td>Docker logo URL</td>
</tr>
<tr>
<td><code>UPD2MQTT_RELNOTES</code></td>
<td>URL to release notes for the package.</td>
<td></td>
</tr>
<tr>
<td><code>UPD2MQTT_GIT_REPO_PATH</code></td>
<td>Relative path to a local git repo if the image is built locally.</td>
<td></td>
</tr>
<tr>
<td><code>UPD2MQTT_IGNORE</code></td>
<td>If set to <code>True</code>, the container will be ignored by updates2mqtt.</td>
<td>False</td>
</tr>
</tbody>
</table>
<h2 id="release-support">Release Support<a class="headerlink" href="#release-support" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Ecosystem</th>
<th>Support</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>Docker</td>
<td>Scan. Fetch</td>
<td>Fetch is <code>docker pull</code> only. Restart support only for <code>docker-compose</code> image based containers.</td>
</tr>
</tbody>
</table>
<h2 id="healthcheck">Healthcheck<a class="headerlink" href="#healthcheck" title="Permanent link">&para;</a></h2>
<p>A heartbeat JSON payload is optionally published periodically to a configurable MQTT topic, defaulting to <code>healthcheck/{node_name}/updates2mqtt</code>. It contains the current version of updates2mqtt, the node name, a timestamp, and some basic stats.</p>
<p>A <code>healthcheck.sh</code> script is included in the Docker image, and can be used as a Docker healthcheck, if the container environment variables are set for <code>MQTT_HOST</code>, <code>MQTT_PORT</code>, <code>MQTT_USER</code> and <code>MQTT_PASS</code>.</p>
<p>TIP: Check healthcheck is working using <code>docker inspect --format "{{json .State.Health }}" updates2mqtt | jq</code></p>
<h2 id="homeassistant-integration">HomeAssistant integration<a class="headerlink" href="#homeassistant-integration" title="Permanent link">&para;</a></h2>
<p>Any updates that have support for automated install will automatically show in the
Home Assistant settings page if the <a href="https://www.home-assistant.io/integrations/mqtt/">MQTT Integration</a> is installed and automatic discovery is not disabled.</p>
<p><img alt="Home Assistant MQTT Integraion configuration" src="images/ha_mqtt_discovery.png" title="Home Assistant MQTT Discovery" /></p>
<p>The <code>homeassistant</code> default topic prefix matches the default updates2mqtt config, if its changed in HomeAssistant, then the updates2mqtt config must be changed to match.</p>
<p><img alt="Home Assistant updates in Settings" src="images/ha_update_page.png" title="Home Assistant Updates" /></p>
<p>For Home Assistant integration, updates2mqtt represents each component being managed as a <a href="https://www.home-assistant.io/integrations/update.mqtt/">MQTT Update</a> entity, and uses [MQTT discovery(https://www.home-assistant.io/integrations/mqtt/#mqtt-discovery)] so that HomeAssistant automatically picks up components discovered by updates2mqtt with zero configuration on HomeAssistant itself. </p>
<p>There are 3 separate types of MQTT topic used for HomeAssisstant integration:</p>
<ul>
<li><em>Config</em> to support auto discovery. A topic is created per component, with a name like <code>homeassistant/update/dockernuc_docker_jellyfin/update/config</code>. This can be disabled in the config file, and the <code>homeassistant</code> topic prefix can also be configured.</li>
<li><em>State</em> to report the current version and the latest version available, again one topic per component, like <code>updates2mqtt/dockernuc/docker/jellyfin</code>.</li>
<li><em>Command</em> to support triggering an update. These will be created on the fly by HomeAssistant when an update is requested, and updates2mqtt subscribes to pick up the changes, so you won&rsquo;t typically see these if browsing MQTT topics. Only one is needed per updates2mqtt agent, with a name like <code>updates2mqtt/dockernuc/docker</code></li>
</ul>
<p>If the package supports automated update, then <em>Skip</em> and <em>Install</em> buttons will appear on the Home Assistant
interface, and the package can be remotely fetched and the component restarted.</p>
<h2 id="related-projects">Related Projects<a class="headerlink" href="#related-projects" title="Permanent link">&para;</a></h2>
<h2 id="-psmqtt-report-system-health-and-metrics-via-mqtt">- <a href="https://github.com/eschava/psmqtt">psmqtt</a> - Report system health and metrics via MQTT<a class="headerlink" href="#-psmqtt-report-system-health-and-metrics-via-mqtt" title="Permanent link">&para;</a></h2>
<h2 id="development">Development<a class="headerlink" href="#development" title="Permanent link">&para;</a></h2>
<p>Access to Docker APIs uses the Python <a href="https://docker-py.readthedocs.io/en/stable/">docker-py</a> SDK for Python. <a href="https://eclipse.dev/paho/files/paho.mqtt.python/html/client.html">Eclipse Paho</a> is used for MQTT access, and <a href="https://omegaconf.readthedocs.io">OmegaConf</a> for configuration.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["content.code.copy", "content.code.select", "content.code.annotate"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>